# 传感器触发策略说明

## 概述

环形超声波雷达系统支持两种传感器触发策略，以满足不同的应用需求。

## 1. 交替扫描模式（Alternating - 基线）

**默认模式**，传感器分组交替触发，避免相邻传感器的超声波干扰。

### 默认配置（奇偶两组）

```python
from ring_sonar_simulator import RingSonarCore

core = RingSonarCore()  # 默认使用alternating模式

# 组0: [0, 2, 4, 6, 8, 10] - 偶数ID传感器
# 组1: [1, 3, 5, 7, 9, 11] - 奇数ID传感器
# 每个step()调用扫描一组，组索引自动循环
```

### 自定义分组

```python
# 例如：3组，120度间隔分布
custom_groups = [
    [0, 3, 6, 9],    # 组0: 0°, 90°, 180°, 270°
    [1, 4, 7, 10],   # 组1: 30°, 120°, 210°, 300°
    [2, 5, 8, 11]    # 组2: 60°, 150°, 240°, 330°
]
core.set_trigger_mode("alternating", groups=custom_groups)
```

### 优势

- ✅ **避免干扰**：相邻传感器不同时触发，减少超声波串扰
- ✅ **性能优越**：计算量减半，速度提升2倍（~640 steps/s）
- ✅ **符合实际**：模拟真实硬件的时序约束
- ✅ **灵活分组**：支持自定义分组模式

### 权衡

- ⚠️ **延迟扫描**：完整360°扫描需要N步（N=组数）
- ⚠️ **数据异步**：不同组传感器的数据时间戳略有差异

## 2. 同时扫描模式（Simultaneous）

所有传感器同时触发，适用于对比实验和完整数据采集。

```python
# 切换到同时模式
core.set_trigger_mode("simultaneous")
```

### 优势

- ✅ **完整同步**：所有传感器数据时间戳一致
- ✅ **简单直接**：无需考虑分组逻辑

### 权衡

- ⚠️ **性能较慢**：计算量大，速度慢50%（~320 steps/s）
- ⚠️ **不符实际**：忽略硬件干扰问题

## API参考

### 查询当前状态

```python
# 获取状态（包含触发模式信息）
state = core.state()
print(f"触发模式: {state['trigger_mode']}")
print(f"当前激活组: {state['active_group']}")

# 获取当前激活的传感器ID列表
active_sensors = core.get_active_sensors()
print(f"激活传感器: {active_sensors}")
```

### 设置触发模式

```python
# 方法签名
core.set_trigger_mode(
    mode: str,                          # "alternating" 或 "simultaneous"
    groups: Optional[List[List[int]]]   # 自定义分组（仅alternating模式）
)
```

## 性能对比

基于200步仿真的性能测试：

| 模式 | 速度 (steps/s) | 相对性能 | 扫描完整性 |
|------|---------------|----------|----------|
| 交替扫描（2组） | 641.9 | 2.0x | 需要2步 |
| 同时扫描 | 319.1 | 1.0x | 1步完整 |

## 使用建议

### 推荐场景

- **实时SLAM应用** → 使用交替扫描（性能优先）
- **强化学习训练** → 使用交替扫描（加速训练）
- **精确对比实验** → 使用同时扫描（数据同步）
- **硬件仿真验证** → 使用交替扫描（符合实际）

### 测试代码

运行完整的触发模式测试：

```bash
python test_trigger_modes.py
```

测试内容：
1. 交替扫描模式验证（奇偶两组）
2. 同时扫描模式验证（所有传感器）
3. 自定义分组验证（3组示例）
4. 性能对比测试（200步基准）

## 未来扩展

系统设计支持以下触发策略（待实现）：

- **优先级扫描**：基于Fisher信息智能选择传感器
- **扇区轮询**：前/后/左/右分区扫描
- **时间分片**：固定时间片轮询
- **混合策略**：动静结合的自适应触发

如需实现其他策略，可参考 `ring_sonar_simulator.py` 中的 `_scan_all_sensors()` 方法。
