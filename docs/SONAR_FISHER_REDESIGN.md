# 超声波雷达Fisher信息重新设计

## 问题分析

### 原有设计的问题
原Fisher计算器设计用于**主动视觉系统**（摄像头），包含三个因子：

1. **距离因子** ✅ - 适用于超声波
2. **角度因子**（主轴对齐）❌ - 不适用（超声波无角度精度信息）
3. **FOV中心质量因子** ❌ - 不适用（超声波回波无中心/边缘差异）

### 超声波雷达的特点

1. **测量类型**：只返回**距离信息**，无角度精度
2. **传感器布局**：12个传感器，30°间隔，65° FOV，环形均匀分布
3. **FOV特性**：超声波在整个FOV内回波质量相近
4. **关键优势**：**传感器重叠区域** = 多传感器验证 = **可信度高**

## 新设计：Sonar Fisher Calculator

### 核心思想
**传感器覆盖度 = 可信度**

多个传感器的FOV重叠的区域，意味着：
- 多个独立测量源
- 交叉验证
- 更高的置信度

### 计算公式

```
Fisher = 距离因子 × 覆盖度因子
```

### 1️⃣ 距离因子（Distance Factor）

**超声波特性**：近距离测量精度更高

```python
normalized_dist = distance / max_range
dist_factor = (1 - normalized_dist)^1.5
```

**非线性衰减**（幂次=1.5）：
- 近距离优势更明显
- 符合超声波精度特性

**示例**：
- 2m（16%）：`(1-0.16)^1.5 = 0.77` ✅
- 5m（40%）：`(1-0.40)^1.5 = 0.46`
- 10m（80%）：`(1-0.80)^1.5 = 0.09`

### 2️⃣ 覆盖度因子（Coverage Factor）

**计算方法**：统计有多少传感器的FOV覆盖该角度

```python
coverage_count = 计算FOV覆盖该角度的传感器数量
coverage_factor = 1.0 + (MAX_BONUS - 1.0) × (count - 1) / (max_count - 1)
```

**参数**：
- `MAX_COVERAGE_BONUS = 3.0` - 最大覆盖加成

**传感器覆盖度分析**（12传感器，30°间隔，65° FOV）：

| 角度 | 覆盖传感器数 | 覆盖因子 | 说明 |
|------|------------|---------|------|
| 0° | 3 | 3.0× | S11, S0, S1 重叠 ✅ 最高可信度 |
| 15° | 2 | 2.0× | S0, S1 重叠 |
| 30° | 3 | 3.0× | S0, S1, S2 重叠 ✅ |
| 45° | 2 | 2.0× | S1, S2 重叠 |
| 60° | 3 | 3.0× | S1, S2, S3 重叠 ✅ |

**发现**：
- 传感器正对方向（0°, 30°, 60°...）：3个传感器覆盖
- 传感器之间（15°, 45°...）：2个传感器覆盖
- 覆盖度呈周期性变化（周期=30°）

### 完整计算示例

**场景1：近距离，传感器正对方向**
```python
distance = 2.0m
angle = 0°  # S11, S0, S1都覆盖

dist_factor = (1 - 2/12.5)^1.5 = 0.77
coverage_count = 3
coverage_factor = 3.0

Fisher = 0.77 × 3.0 = 2.31 🌟 高可信度！
```

**场景2：中距离，传感器之间**
```python
distance = 5.0m
angle = 15°  # S0, S1覆盖

dist_factor = (1 - 5/12.5)^1.5 = 0.46
coverage_count = 2
coverage_factor = 2.0

Fisher = 0.46 × 2.0 = 0.92
```

**场景3：远距离，传感器正对**
```python
distance = 10.0m
angle = 0°  # S11, S0, S1覆盖

dist_factor = (1 - 10/12.5)^1.5 = 0.10
coverage_count = 3
coverage_factor = 3.0

Fisher = 0.10 × 3.0 = 0.30  # 虽然覆盖度高，但距离太远
```

## 对比：旧 vs 新

### 旧设计（视觉系统）
```
Fisher = 距离因子 × 角度因子(主轴) × FOV中心因子
        ↓           ↓                 ↓
      适用       不适用（无角度）   不适用（无质量差异）
```

### 新设计（超声波系统）
```
Fisher = 距离因子 × 覆盖度因子
        ↓           ↓
      适用       关键创新！
```

## 优势

1. **符合物理特性**：
   - ✅ 距离精度：近距离更可靠
   - ✅ 覆盖度：多传感器验证
   - ✅ 无FOV质量假设

2. **实用价值**：
   - 传感器重叠区域自动获得高Fisher值
   - 引导机器人利用多传感器验证的区域
   - 适合SLAM和主动探索

3. **计算效率**：
   - 更简单（2因子 vs 3因子）
   - 可预计算覆盖度地图
   - 支持批量计算

## 可视化

运行以下命令生成覆盖度地图：
```bash
python sonar_fisher_calculator.py
```

输出：`sonar_coverage_map.png` - 极坐标覆盖度可视化

## 实现文件

- `sonar_fisher_calculator.py` - 新Fisher计算器
- `ring_sonar_simulator.py` - 已集成新计算器

## 测试结果

```
近距离, 正前方 (Sensor 0中心)
  距离=2.0m, 角度=0.0° → Fisher=2.310, 覆盖度=3

中距离, 正前方
  距离=5.0m, 角度=0.0° → Fisher=1.394, 覆盖度=3

远距离, 正前方
  距离=10.0m, 角度=0.0° → Fisher=0.300, 覆盖度=3
```

✅ **符合预期**：距离因子主导，覆盖度提供加成

---

**设计日期**：2025-11-27  
**设计目的**：为超声波雷达系统提供符合物理特性的Fisher信息计算
